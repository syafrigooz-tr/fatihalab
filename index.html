<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Abang Fatih vs Abang Alab</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 20px; background: #f0f0f0; }
  canvas { border: 2px solid #333; display: block; margin: 20px auto; background: white; }
  #info { font-size: 18px; margin-top: 10px; }

  /* üîπ Score kecil di kanan atas */
  #score { 
    font-size: 12px; 
    position: absolute; 
    top: 10px; 
    right: 10px; 
    background: rgba(255,255,255,0.7); 
    padding: 3px 8px; 
    border-radius: 6px; 
  }

  button { padding: 10px 20px; font-size: 18px; margin-top: 15px; cursor: pointer; display: inline-block; }

  /* üîπ Tombol lompat di kanan bawah */
  #jumpBtn { 
    position: absolute;
    bottom: 10px;
    right: 10px;
    padding: 12px 30px; 
    font-size: 18px; 
    background: #28a745; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    cursor: pointer;
  }

  /* üîπ Tombol tengah (Start & Giliran) */
  #startBtn, #nextTurnBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 35px;
    font-size: 20px;
    border: none;
    border-radius: 12px;
    background: #007bff;
    color: white;
    cursor: pointer;
    display: none;
  }

  #restartBtn { display: none; }

  .logo {
    max-width: 300px;
    display: block;
    margin: 0 auto 10px auto;
  }

  /* üîπ Intro screen */
  #introScreen h1, 
  #introScreen p {
    max-width: 300px;
    margin: 10px auto;
  }

  /* üîπ Layar Winner */
  #gameOverScreen {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.9);
    color: white;
    text-align: center;
    padding-top: 50px;
    z-index: 999;
  }
  #gameOverScreen h1 { font-size: 50px; margin-bottom: 20px; letter-spacing: 2px; }
  #gameOverScreen img { width: 150px; margin: 20px 0; border-radius: 12px; }
  #gameOverScreen p { font-size: 22px; margin-bottom: 20px; }
  #gameOverScreen button {
    padding: 12px 25px;
    font-size: 20px;
    border: none;
    border-radius: 12px;
    background: #28a745;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- üîπ Halaman Intro -->
<div id="introScreen">
  <img src="Gambarsatuaaa.png" alt="Logo Game" class="logo">
  <button id="playBtn">Mainkan</button>
  <h1>üèÉ Abang Fatih vs Abang Alab üèÉ</h1>
  <p>17 <b>Agustus</b> 1945</p>
</div>

<!-- üîπ Halaman Game -->
<div id="gameScreen" style="display:none; position:relative;">
  <button id="startBtn">Mulai Game</button>
  <button id="nextTurnBtn">Giliran Abang Alab</button>
  <button id="restartBtn">Main Lagi</button>

  <canvas id="gameCanvas" width="600" height="200"></canvas>
  <div id="info"></div>
  <div id="score"></div>
  <button id="jumpBtn">Lompat</button>
</div>

<!-- üîπ Layar Winner -->
<div id="gameOverScreen">
  <h1>WINNER</h1>
  <img id="winnerImg" src="" alt="Pemenang">
  <p id="scoreText"></p>
  <button onclick="restartFullGame()">Main Lagi!</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Load gambar pemain
const imgFatih = new Image();
imgFatih.src = "Gambar1.png";
const imgAlab = new Image();
imgAlab.src = "Gambar2.png";

// Flag gambar siap
let imgFatihReady = false;
let imgAlabReady = false;
imgFatih.onload = () => { imgFatihReady = true; };
imgAlab.onload = () => { imgAlabReady = true; };

let player = { x: 50, y: 150, size: 40, vy: 0, gravity: 1, jump: -15, grounded: true };
let obstacles = [];
let distance = 0;
let finishLine = 15000;
let obstacleSpeed = 3;
let gameOver = false;
let currentPlayer = 1; // 1 = Fatih, 2 = Alab
let scores = {1:0,2:0};
let times = {1:null,2:null};
let gameRunning = false;
let startTime;

function resetGame(){
  player.y = 150; player.vy=0; player.grounded=true;
  obstacles = generateObstacles();
  distance=0; gameOver=false; obstacleSpeed=3;
  document.getElementById("score").textContent = "0 / " + finishLine;
  document.getElementById("info").textContent = "";
  startTime = null;
}

// üîπ Gambar rintangan
function drawSawit(x, y) {
  ctx.fillStyle = "#8B4513"; 
  ctx.fillRect(x + 5, y - 40, 10, 40);
  ctx.beginPath();
  ctx.fillStyle = "green";
  ctx.moveTo(x - 10, y - 40);
  ctx.lineTo(x + 10, y - 60);
  ctx.lineTo(x + 30, y - 40);
  ctx.fill();
  ctx.beginPath();
  ctx.moveTo(x - 5, y - 25);
  ctx.lineTo(x + 10, y - 50);
  ctx.lineTo(x + 25, y - 25);
  ctx.fill();
}

function generateObstacles(){
  let obs=[]; let pos=300;
  while(pos<finishLine){
    obs.push({x:pos,y:canvas.height});
    pos += Math.floor(Math.random()*201)+250;
  }
  return obs;
}

function drawObstacles(offset){ obstacles.forEach(o => drawSawit(o.x - offset, o.y)); }

function checkCollision(o){
  const ox = o.x - distance + 5;
  const oy = o.y - 40;
  return (player.x < ox + 10 &&
          player.x + player.size > ox &&
          player.y + player.size > oy);
}

function drawPlayer(){
  if (currentPlayer===1 && imgFatihReady) ctx.drawImage(imgFatih, player.x, player.y, player.size, player.size);
  else if (currentPlayer===2 && imgAlabReady) ctx.drawImage(imgAlab, player.x, player.y, player.size, player.size);
  else { ctx.fillStyle = currentPlayer===1 ? "blue" : "green"; ctx.fillRect(player.x, player.y, player.size, player.size); }
}

function drawFinishLine(offset){ ctx.fillStyle="black"; ctx.fillRect(finishLine - offset, 0, 5, canvas.height); }

function update(){
  if(!gameRunning || gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(!startTime) startTime=Date.now();
  player.y += player.vy;
  player.vy += player.gravity;
  if(player.y>=150){ player.y=150; player.vy=0; player.grounded=true; }
  distance += obstacleSpeed;
  if(distance>finishLine-400) obstacleSpeed=6;
  if(distance>=finishLine){
    let timeTaken=(Date.now()-startTime)/1000;
    gameOver=true; gameRunning=false;
    scores[currentPlayer]=finishLine;
    times[currentPlayer]=timeTaken;
    nextTurn(true); return;
  }
  for(let o of obstacles){ if(checkCollision(o)){ gameOver=true; gameRunning=false; scores[currentPlayer]=distance; nextTurn(false); return; } }
  drawPlayer(); drawObstacles(distance); drawFinishLine(distance);
  document.getElementById("score").textContent=distance+" / "+finishLine;
  if(!gameOver) requestAnimationFrame(update);
}

function nextTurn(finished){
  if(currentPlayer===1){
    document.getElementById("info").innerHTML =
      "‚úÖ Giliran Abang Fatih selesai! " + (finished ? "(Finish: "+times[1]+" dtk)" : "(Jarak: "+scores[1]+")");
    document.getElementById("nextTurnBtn").style.display="block";
  } else {
    let winnerName="",winnerImg="";
    if(scores[1]>=finishLine && scores[2]>=finishLine){
      if(times[1]<times[2]){winnerName="Abang Fatih";winnerImg=imgFatih.src;}
      else if(times[2]<times[1]){winnerName="Abang Alab";winnerImg=imgAlab.src;}
      else { showWinnerScreen("Seri! Waktu sama!"); return; }
    } else if(scores[1]>scores[2]){ winnerName="Abang Fatih"; winnerImg=imgFatih.src; }
    else if(scores[2]>scores[1]){ winnerName="Abang Alab"; winnerImg=imgAlab.src; }
    else { showWinnerScreen("Seri! Skor sama!"); return; }
    const skorText = `Skor: ${scores[1]} - ${scores[2]} | Waktu: ${times[1]??"-"} vs ${times[2]??"-"}`;
    showWinnerScreen(`${winnerName} menang! ${skorText}`, winnerImg);
  }
}

function showWinnerScreen(text, imgSrc=""){
  const overlay=document.getElementById("gameOverScreen");
  overlay.style.display="block";
  document.getElementById("scoreText").innerText=text;
  if(imgSrc){ document.getElementById("winnerImg").src=imgSrc; document.getElementById("winnerImg").style.display="inline-block"; }
  else { document.getElementById("winnerImg").style.display="none"; }
}

function restartFullGame(){
  document.getElementById("gameOverScreen").style.display="none";
  currentPlayer=1; scores={1:0,2:0}; times={1:null,2:null};
  document.getElementById("nextTurnBtn").style.display="none";
  startTurn();
}

function startTurn(){
  resetGame(); gameRunning=true;
  document.getElementById("info").innerHTML="Giliran: "+(currentPlayer===1?"Abang Fatih":"Abang Alab");
  update();
}

// üîπ Kontrol lompat
document.getElementById("jumpBtn").addEventListener("click", ()=>{ if(player.grounded && gameRunning){ player.vy=player.jump; player.grounded=false; } });
document.addEventListener("keydown", e=>{ if(e.code==="Space"){ e.preventDefault(); if(player.grounded && gameRunning){ player.vy=player.jump; player.grounded=false; } } });

// üîπ Tombol UI
document.getElementById("playBtn").addEventListener("click", ()=>{ document.getElementById("introScreen").style.display="none"; document.getElementById("gameScreen").style.display="block"; document.getElementById("startBtn").style.display="inline-block"; });
document.getElementById("startBtn").addEventListener("click", ()=>{ currentPlayer=1; scores={1:0,2:0}; times={1:null,2:null}; document.getElementById("startBtn").style.display="none"; startTurn(); });
document.getElementById("nextTurnBtn").addEventListener("click", ()=>{ currentPlayer=2; document.getElementById("nextTurnBtn").style.display="none"; startTurn(); });
document.getElementById("restartBtn").addEventListener("click", ()=>{ currentPlayer=1; scores={1:0,2:0}; times={1:null,2:null}; startTurn(); });
</script>
</body>
</html>

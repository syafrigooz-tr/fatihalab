<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Abang Fatih vs Abang Alab</title>
<style>
  body { font-family: Arial; text-align:center; margin:0; padding:20px; background:#f0f0f0; }
  canvas { border:2px solid #333; display:block; margin:20px auto; background:white; }
  #info,#score,#winner { font-size:18px; margin-top:10px; }
  button { padding:10px 20px; font-size:18px; margin-top:15px; cursor:pointer; display:inline-block; }
  #restartBtn,#nextTurnBtn { display:none; }
</style>
</head>
<body>
<h1>üèÉ Game Abang Fatih vs Abang Alab üèÉ</h1>
<p>Tekan <b>Spasi</b> untuk lompat.</p>

<button id="startBtn" disabled>Mulai Game</button>
<button id="nextTurnBtn">Giliran Abang Alab</button>
<button id="restartBtn">Main Lagi</button>

<canvas id="gameCanvas" width="600" height="200"></canvas>
<div id="info"></div>
<div id="score"></div>
<div id="winner"></div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// üîπ Gambar pohon aman dan CORS-friendly dari Pixabay
const palmImg = new Image();
palmImg.src = "https://cdn.pixabay.com/photo/2013/07/12/15/42/palm-tree-152148_1280.png";

let player = {x:50,y:150,size:30,vy:0,gravity:1,jump:-15,grounded:true};
let obstacles=[], distance=0, finishLine=2000, obstacleSpeed=3;
let gameOver=false, currentPlayer=1;
let scores={1:0,2:0}, times={1:null,2:null};
let gameRunning=false, startTime;

function resetGame(){
  player.y=150; player.vy=0; player.grounded=true;
  obstacles=generateObstacles();
  distance=0; gameOver=false; obstacleSpeed=3;
  document.getElementById("score").textContent="Jarak: 0 / "+finishLine;
  document.getElementById("winner").textContent="";
  startTime=null;
}

function generateObstacles(){
  let obs=[], pos=300;
  while(pos<finishLine){
    let h=Math.floor(Math.random()*51)+50;
    let w=Math.floor(h*0.6);
    obs.push({x:pos,y:180-h,width:w,height:h});
    pos+=Math.floor(Math.random()*201)+200;
  }
  return obs;
}

function drawPlayer(){ ctx.fillStyle=currentPlayer===1?"blue":"green"; ctx.fillRect(player.x,player.y,player.size,player.size); }
function drawObstacles(offset){ for(let o of obstacles) ctx.drawImage(palmImg,o.x-offset,o.y,o.width,o.height); }
function drawFinishLine(offset){ ctx.fillStyle="black"; ctx.fillRect(finishLine-offset,0,5,canvas.height); }

function update(){
  if(!gameRunning||gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#cce0ff"; ctx.fillRect(0,0,canvas.width,canvas.height);

  if(!startTime) startTime=Date.now();
  player.y+=player.vy; player.vy+=player.gravity;
  if(player.y>=150){ player.y=150; player.vy=0; player.grounded=true; }

  distance+=obstacleSpeed;

  if(distance>=finishLine){ 
    let t=(Date.now()-startTime)/1000;
    gameOver=true; gameRunning=false;
    scores[currentPlayer]=finishLine; times[currentPlayer]=t;
    nextTurn(true); return;
  }

  for(let o of obstacles){
    if(player.x<o.x-distance+o.width && player.x+player.size>o.x-distance && player.y+player.size>o.y){
      gameOver=true; gameRunning=false;
      scores[currentPlayer]=distance;
      nextTurn(false); return;
    }
  }

  drawPlayer(); drawObstacles(distance); drawFinishLine(distance);
  document.getElementById("score").textContent="Jarak: "+distance+" / "+finishLine;
  if(!gameOver) requestAnimationFrame(update);
}

function nextTurn(finished){
  if(currentPlayer===1){
    document.getElementById("info").innerHTML="‚úÖ Giliran Abang Fatih selesai! "+(finished?"(Finish dalam "+times[1]+" dtk)":"(Jarak: "+scores[1]+")");
    document.getElementById("nextTurnBtn").style.display="inline-block";
  } else {
    let winnerText="";
    if(scores[1]>=finishLine && scores[2]>=finishLine) winnerText=times[1]<times[2]?"üéâ Pemenang: Abang Fatih (lebih cepat)!":"üéâ Pemenang: Abang Alab (lebih cepat)!";
    else if(scores[1]>scores[2]) winnerText="üéâ Pemenang: Abang Fatih!";
    else if(scores[2]>scores[1]) winnerText="üéâ Pemenang: Abang Alab!";
    else winnerText="ü§ù Seri!";
    document.getElementById("winner").textContent=winnerText;
    document.getElementById("info").innerHTML=`Hasil üëâ Fatih: ${scores[1]} (${times[1]?times[1]+" dtk":"belum finish"}) | Alab: ${scores[2]} (${times[2]?times[2]+" dtk":"belum finish"})`;
    document.getElementById("restartBtn").style.display="inline-block";
  }
}

function startTurn(){ resetGame(); gameRunning=true; document.getElementById("info").innerHTML="Giliran: <b>"+(currentPlayer===1?"Abang Fatih":"Abang Alab")+"</b>"; update(); }

document.addEventListener("keydown",e=>{ if(e.code==="Space"&&player.grounded&&gameRunning){ player.vy=player.jump; player.grounded=false; } });

const startBtn=document.getElementById("startBtn");
palmImg.onload=()=>{ startBtn.disabled=false; }

startBtn.addEventListener("click",()=>{ currentPlayer=1; scores={1:0,2:0}; times={1:null,2:null}; startBtn.style.display="none"; document.getElementById("restartBtn").style.display="none"; startTurn(); });
document.getElementById("nextTurnBtn").addEventListener("click",()=>{ currentPlayer=2; document.getElementById("nextTurnBtn").style.display="none"; startTurn(); });
document.getElementById("restartBtn").addEventListener("click",()=>{ currentPlayer=1; scores={1:0,2:0}; times={1:null,2:null}; document.getElementById("restartBtn").style.display="none"; startTurn(); });
</script>
</body>
</html>
